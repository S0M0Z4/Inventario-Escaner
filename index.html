<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gestor de Anuncios - Iglesia</title>
    <style>
        /* Estilos generales */
        :root {
            --azul-principal: #1e3a8a;
            --azul-secundario: #3b82f6;
            --azul-claro: #dbeafe;
            --blanco: #ffffff;
            --gris-claro: #f3f4f6;
            --gris: #9ca3af;
            --gris-oscuro: #374151;
            --sombra: 0 4px 6px rgba(0, 0, 0, 0.1);
            --verde: #10b981;
            --rojo: #ef4444;
            --naranja: #f59e0b;
            --morado: #8b5cf6;
            --amarillo: #fbbf24;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background-color: var(--gris-claro);
            color: var(--gris-oscuro);
            line-height: 1.6;
            min-height: 100vh;
        }
        
        /* Encabezado */
        .header {
            background-color: var(--azul-principal);
            color: var(--blanco);
            padding: 1rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: var(--sombra);
            flex-wrap: wrap;
            gap: 1rem;
        }
        
        .logo {
            display: flex;
            align-items: center;
            gap: 0.8rem;
        }
        
        .logo h1 {
            font-size: 1.4rem;
            font-weight: 600;
        }
        
        .logo-icon {
            font-size: 1.8rem;
        }
        
        /* Formulario de login */
        .login-container {
            position: relative;
            display: flex;
            gap: 0.5rem;
        }
        
        .login-btn, .admin-view-btn, .sync-btn {
            background-color: var(--azul-secundario);
            color: white;
            border: none;
            padding: 0.5rem 1rem;
            border-radius: 4px;
            cursor: pointer;
            font-weight: 500;
            transition: background-color 0.3s;
            font-size: 0.9rem;
        }
        
        .login-btn:hover, .admin-view-btn:hover, .sync-btn:hover {
            background-color: #2563eb;
        }
        
        .admin-view-btn {
            background-color: var(--verde);
            display: none;
        }
        
        .admin-view-btn:hover {
            background-color: #0da271;
        }
        
        .sync-btn {
            background-color: var(--morado);
            display: none;
        }
        
        .sync-btn:hover {
            background-color: #7c3aed;
        }
        
        .login-form {
            position: absolute;
            top: 100%;
            right: 0;
            background-color: var(--blanco);
            padding: 1.2rem;
            border-radius: 8px;
            box-shadow: var(--sombra);
            width: 300px;
            display: none;
            z-index: 100;
            margin-top: 0.5rem;
        }
        
        .login-form.active {
            display: block;
        }
        
        .login-form h3 {
            margin-bottom: 1rem;
            color: var(--azul-principal);
            text-align: center;
            font-size: 1.1rem;
        }
        
        .form-group {
            margin-bottom: 1rem;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 0.3rem;
            font-weight: 500;
            font-size: 0.9rem;
        }
        
        .form-group input {
            width: 100%;
            padding: 0.6rem;
            border: 1px solid var(--gris);
            border-radius: 4px;
            font-size: 0.9rem;
        }
        
        .form-group input:focus {
            outline: none;
            border-color: var(--azul-secundario);
        }
        
        .submit-btn {
            background-color: var(--azul-principal);
            color: white;
            border: none;
            padding: 0.6rem;
            width: 100%;
            border-radius: 4px;
            cursor: pointer;
            font-weight: 500;
            transition: background-color 0.3s;
            margin-top: 0.5rem;
            font-size: 0.9rem;
        }
        
        .submit-btn:hover {
            background-color: #1d4ed8;
        }
        
        .logout-btn {
            background-color: var(--rojo);
            color: white;
            border: none;
            padding: 0.5rem 1rem;
            border-radius: 4px;
            cursor: pointer;
            font-weight: 500;
            transition: background-color 0.3s;
            display: none;
            font-size: 0.9rem;
        }
        
        .logout-btn:hover {
            background-color: #b91c1c;
        }
        
        /* Bot√≥n de volver */
        .back-btn {
            background-color: var(--gris);
            color: white;
            border: none;
            padding: 0.5rem 1rem;
            border-radius: 4px;
            cursor: pointer;
            font-weight: 500;
            transition: background-color 0.3s;
            display: none;
            font-size: 0.9rem;
        }
        
        .back-btn:hover {
            background-color: #6b7280;
        }
        
        /* Contenedor principal */
        .container {
            max-width: 1200px;
            margin: 1.5rem auto;
            padding: 0 1rem;
        }
        
        /* Mensaje de bienvenida */
        .welcome-message {
            background-color: var(--blanco);
            border-radius: 8px;
            padding: 1.5rem;
            box-shadow: var(--sombra);
            margin-bottom: 1.5rem;
            text-align: center;
        }
        
        .welcome-message h2 {
            color: var(--azul-principal);
            margin-bottom: 0.5rem;
        }
        
        /* Pantalla de selecci√≥n de departamento */
        .department-selection {
            background-color: var(--blanco);
            border-radius: 8px;
            padding: 1.5rem;
            box-shadow: var(--sombra);
        }
        
        .department-selection h2 {
            color: var(--azul-principal);
            margin-bottom: 1.5rem;
            font-size: 1.5rem;
            text-align: center;
        }
        
        .departments-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 1rem;
            margin-bottom: 1.5rem;
        }
        
        .department-card {
            background-color: var(--azul-claro);
            border-radius: 8px;
            padding: 1.2rem 1rem;
            cursor: pointer;
            transition: transform 0.3s, box-shadow 0.3s;
            border: 2px solid transparent;
            text-align: center;
            min-height: 120px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
        }
        
        .department-card:hover {
            transform: translateY(-3px);
            box-shadow: var(--sombra);
            border-color: var(--azul-secundario);
        }
        
        .department-card.juvenil {
            background-color: #e0f2fe;
        }
        
        .department-icon {
            font-size: 2rem;
            margin-bottom: 0.5rem;
            color: var(--azul-principal);
        }
        
        .department-card h3 {
            color: var(--azul-principal);
            font-size: 1rem;
            margin-bottom: 0.3rem;
        }
        
        .department-card p {
            color: var(--gris-oscuro);
            font-size: 0.8rem;
        }
        
        /* Subcategor√≠as para Ministerio Joven */
        .subcategories {
            margin-top: 1.5rem;
            padding-top: 1.5rem;
            border-top: 2px solid var(--azul-claro);
            display: none;
        }
        
        .subcategories.active {
            display: block;
        }
        
        .subcategories h3 {
            color: var(--azul-principal);
            margin-bottom: 1rem;
            text-align: center;
        }
        
        .subcategories-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
            gap: 1rem;
        }
        
        .subcategory-card {
            background-color: var(--blanco);
            border-radius: 8px;
            padding: 1rem;
            cursor: pointer;
            transition: transform 0.3s, box-shadow 0.3s;
            border: 2px solid var(--azul-claro);
            text-align: center;
        }
        
        .subcategory-card:hover {
            transform: translateY(-3px);
            box-shadow: var(--sombra);
            border-color: var(--azul-secundario);
        }
        
        .subcategory-card h4 {
            color: var(--azul-principal);
            font-size: 0.95rem;
            margin-bottom: 0.3rem;
        }
        
        /* Opciones JA y Clubes */
        .juvenil-options {
            margin-top: 1.5rem;
            padding-top: 1.5rem;
            border-top: 2px solid var(--azul-claro);
            display: none;
        }
        
        .juvenil-options.active {
            display: block;
        }
        
        .juvenil-options h3 {
            color: var(--azul-principal);
            margin-bottom: 1rem;
            text-align: center;
        }
        
        .option-cards {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 1rem;
        }
        
        .option-card {
            background-color: var(--blanco);
            border-radius: 8px;
            padding: 1.5rem 1rem;
            cursor: pointer;
            transition: transform 0.3s, box-shadow 0.3s;
            border: 2px solid var(--azul-claro);
            text-align: center;
        }
        
        .option-card:hover {
            transform: translateY(-3px);
            box-shadow: var(--sombra);
            border-color: var(--azul-secundario);
        }
        
        .option-card.ja {
            background-color: #dbeafe;
        }
        
        .option-card.clubes {
            background-color: #e0f2fe;
        }
        
        .option-card h4 {
            color: var(--azul-principal);
            font-size: 1.1rem;
            margin-bottom: 0.5rem;
        }
        
        .option-icon {
            font-size: 2.5rem;
            margin-bottom: 0.5rem;
            color: var(--azul-principal);
        }
        
        /* Secci√≥n de formulario de anuncios */
        .announcement-form-section {
            background-color: var(--blanco);
            border-radius: 8px;
            padding: 1.5rem;
            box-shadow: var(--sombra);
            margin-bottom: 1.5rem;
            display: none;
        }
        
        .announcement-form-section.active {
            display: block;
        }
        
        .section-title {
            color: var(--azul-principal);
            margin-bottom: 1.2rem;
            padding-bottom: 0.5rem;
            border-bottom: 2px solid var(--azul-claro);
            font-size: 1.3rem;
        }
        
        .announcement-form {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
        }
        
        .form-control {
            display: flex;
            flex-direction: column;
        }
        
        .form-control label {
            margin-bottom: 0.4rem;
            font-weight: 500;
            font-size: 0.9rem;
        }
        
        .form-control select, 
        .form-control input, 
        .form-control textarea {
            padding: 0.6rem;
            border: 1px solid var(--gris);
            border-radius: 4px;
            font-size: 0.9rem;
        }
        
        .form-control textarea {
            min-height: 80px;
            resize: vertical;
        }
        
        .form-control select:focus, 
        .form-control input:focus, 
        .form-control textarea:focus {
            outline: none;
            border-color: var(--azul-secundario);
        }
        
        .btn-submit-announcement {
            grid-column: 1 / -1;
            background-color: var(--azul-principal);
            color: white;
            border: none;
            padding: 0.7rem;
            border-radius: 4px;
            cursor: pointer;
            font-weight: 500;
            font-size: 0.95rem;
            transition: background-color 0.3s;
        }
        
        .btn-submit-announcement:hover {
            background-color: #1d4ed8;
        }
        
        /* Secci√≥n para mostrar anuncios */
        .announcements-section {
            background-color: var(--blanco);
            border-radius: 8px;
            padding: 1.5rem;
            box-shadow: var(--sombra);
            display: none;
        }
        
        .announcements-section.active {
            display: block;
        }
        
        .current-department {
            background-color: var(--azul-claro);
            padding: 1rem;
            border-radius: 8px;
            margin-bottom: 1.2rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 1rem;
        }
        
        .current-department h3 {
            color: var(--azul-principal);
            font-size: 1.2rem;
        }
        
        .announcements-container {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 1.2rem;
        }
        
        .announcement-card {
            background-color: var(--azul-claro);
            border-radius: 8px;
            padding: 1.2rem;
            border-left: 4px solid var(--azul-principal);
            position: relative;
        }
        
        .announcement-card.mine {
            border-left-color: var(--naranja);
        }
        
        .announcement-card h3 {
            color: var(--azul-principal);
            margin-bottom: 0.5rem;
            font-size: 1.1rem;
            padding-right: 50px;
        }
        
        .announcement-meta {
            display: flex;
            flex-direction: column;
            gap: 0.3rem;
            margin-bottom: 0.8rem;
            font-size: 0.85rem;
            color: var(--gris-oscuro);
        }
        
        .announcement-category {
            background-color: var(--azul-secundario);
            color: white;
            padding: 0.2rem 0.5rem;
            border-radius: 4px;
            font-size: 0.75rem;
            display: inline-block;
            margin-bottom: 0.5rem;
        }
        
        .announcement-description {
            margin-top: 0.8rem;
            line-height: 1.5;
            font-size: 0.9rem;
        }
        
        .announcement-author {
            font-size: 0.8rem;
            color: var(--gris-oscuro);
            margin-top: 0.8rem;
            padding-top: 0.5rem;
            border-top: 1px dashed var(--gris);
        }
        
        /* Botones de acci√≥n */
        .announcement-actions {
            position: absolute;
            top: 1.2rem;
            right: 1.2rem;
            display: flex;
            gap: 0.4rem;
        }
        
        .action-btn {
            width: 28px;
            height: 28px;
            border-radius: 4px;
            border: none;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.8rem;
            transition: transform 0.2s;
        }
        
        .action-btn:hover {
            transform: scale(1.1);
        }
        
        .edit-btn {
            background-color: var(--verde);
            color: white;
        }
        
        .delete-btn {
            background-color: var(--rojo);
            color: white;
        }
        
        /* Panel de administrador */
        .admin-panel {
            background-color: var(--blanco);
            border-radius: 8px;
            padding: 1.5rem;
            box-shadow: var(--sombra);
            display: none;
        }
        
        .admin-panel.active {
            display: block;
        }
        
        .admin-announcements {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 1.2rem;
        }
        
        /* Panel de sincronizaci√≥n */
        .sync-panel {
            background-color: var(--blanco);
            border-radius: 8px;
            padding: 1.5rem;
            box-shadow: var(--sombra);
            margin-top: 1.5rem;
            display: none;
        }
        
        .sync-panel.active {
            display: block;
        }
        
        .sync-options {
            display: flex;
            flex-direction: column;
            gap: 1rem;
            margin-top: 1rem;
        }
        
        .sync-option {
            background-color: var(--azul-claro);
            padding: 1rem;
            border-radius: 8px;
            border: 1px solid var(--azul-secundario);
        }
        
        .sync-option h4 {
            color: var(--azul-principal);
            margin-bottom: 0.5rem;
        }
        
        /* Panel de edici√≥n de anuncios (oculto por defecto) */
        .edit-panel {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 1000;
        }
        
        .edit-panel.active {
            display: flex;
        }
        
        .edit-form {
            background-color: var(--blanco);
            width: 90%;
            max-width: 600px;
            padding: 1.5rem;
            border-radius: 8px;
            box-shadow: var(--sombra);
            max-height: 90vh;
            overflow-y: auto;
        }
        
        .edit-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.2rem;
        }
        
        .edit-header h3 {
            color: var(--azul-principal);
            font-size: 1.2rem;
        }
        
        .close-btn {
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: var(--gris-oscuro);
        }
        
        /* Mensajes */
        .message {
            padding: 0.8rem;
            border-radius: 4px;
            margin-bottom: 1.2rem;
            text-align: center;
            display: none;
            font-size: 0.9rem;
        }
        
        .message.success {
            background-color: #dcfce7;
            color: #166534;
            border: 1px solid #bbf7d0;
            display: block;
        }
        
        .message.error {
            background-color: #fee2e2;
            color: #991b1b;
            border: 1px solid #fecaca;
            display: block;
        }
        
        .message.info {
            background-color: var(--azul-claro);
            color: var(--azul-principal);
            border: 1px solid var(--azul-secundario);
            display: block;
        }
        
        .message.warning {
            background-color: #fef3c7;
            color: #92400e;
            border: 1px solid #fde68a;
            display: block;
        }
        
        .empty-message {
            grid-column: 1 / -1;
            text-align: center;
            padding: 1.5rem;
            color: var(--gris);
            font-size: 0.95rem;
        }
        
        /* Estado de carga */
        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(0,0,0,.3);
            border-radius: 50%;
            border-top-color: var(--azul-principal);
            animation: spin 1s ease-in-out infinite;
            margin-right: 0.5rem;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        /* Informaci√≥n de sincronizaci√≥n */
        .sync-info {
            background-color: var(--azul-claro);
            padding: 0.8rem;
            border-radius: 8px;
            margin-top: 1rem;
            font-size: 0.85rem;
            color: var(--azul-principal);
            text-align: center;
        }
        
        /* Configuraci√≥n de GitHub */
        .github-config {
            background-color: #f3f4f6;
            padding: 1rem;
            border-radius: 8px;
            margin-top: 1rem;
            border: 1px solid #d1d5db;
        }
        
        .github-config h4 {
            color: var(--azul-principal);
            margin-bottom: 0.5rem;
        }
        
        /* Responsive para tel√©fonos */
        @media (max-width: 768px) {
            .header {
                flex-direction: column;
                text-align: center;
                padding: 0.8rem;
            }
            
            .logo h1 {
                font-size: 1.2rem;
            }
            
            .login-container {
                width: 100%;
                justify-content: center;
                flex-wrap: wrap;
            }
            
            .login-form {
                position: fixed;
                top: 50%;
                left: 50%;
                transform: translate(-50%, -50%);
                width: 90%;
                max-width: 300px;
            }
            
            .departments-grid {
                grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
            }
            
            .department-card {
                min-height: 100px;
                padding: 0.8rem;
            }
            
            .department-icon {
                font-size: 1.5rem;
            }
            
            .department-card h3 {
                font-size: 0.9rem;
            }
            
            .subcategories-grid, .option-cards {
                grid-template-columns: repeat(auto-fill, minmax(140px, 1fr));
            }
            
            .announcement-form {
                grid-template-columns: 1fr;
            }
            
            .announcements-container, .admin-announcements {
                grid-template-columns: 1fr;
            }
            
            .announcement-card h3 {
                padding-right: 0;
                margin-bottom: 0.8rem;
            }
            
            .announcement-actions {
                position: static;
                margin-bottom: 0.8rem;
                justify-content: flex-start;
            }
            
            .current-department {
                flex-direction: column;
                align-items: flex-start;
            }
            
            .current-department h3 {
                font-size: 1.1rem;
            }
            
            .container {
                padding: 0 0.8rem;
                margin: 1rem auto;
            }
        }
        
        @media (max-width: 480px) {
            .departments-grid {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .subcategories-grid, .option-cards {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .department-card {
                min-height: 90px;
                padding: 0.7rem;
            }
            
            .logo h1 {
                font-size: 1.1rem;
            }
            
            .section-title {
                font-size: 1.2rem;
            }
        }
    </style>
</head>
<body>
    <!-- Encabezado con login -->
    <header class="header">
        <div class="logo">
            <div class="logo-icon">‚õ™</div>
            <h1>Gestor de Anuncios - Iglesia</h1>
        </div>
        <div class="login-container">
            <button id="loginBtn" class="login-btn">Iniciar Sesi√≥n</button>
            <button id="adminViewBtn" class="admin-view-btn">Vista Admin</button>
            <div id="loginForm" class="login-form">
                <h3>Acceso Administrador</h3>
                <div class="form-group">
                    <label for="username">Usuario:</label>
                    <input type="text" id="username" placeholder="Ingresa tu usuario">
                </div>
                <div class="form-group">
                    <label for="password">Contrase√±a:</label>
                    <input type="password" id="password" placeholder="Ingresa tu contrase√±a">
                </div>
                <button id="submitLogin" class="submit-btn">Ingresar</button>
                <p style="margin-top: 0.7rem; font-size: 0.8rem; color: #666;">
                    Credenciales: Usuario: <strong>Admin</strong>, Contrase√±a: <strong>Aa.1234#</strong>
                </p>
            </div>
            <button id="logoutBtn" class="logout-btn">Cerrar Sesi√≥n</button>
            <button id="backBtn" class="back-btn">‚Üê Volver</button>
        </div>
    </header>

    <!-- Contenido principal -->
    <main class="container">
        <!-- Mensaje de bienvenida -->
        <div id="welcomeMessage" class="welcome-message">
            <h2>Bienvenido al Sistema de Anuncios de la Iglesia</h2>
            <p>Selecciona tu departamento o ministerio para ver los anuncios correspondientes</p>
            <div id="cloudStatus" class="message info" style="margin-top: 1rem; display: none;">
                <span id="statusText"></span>
            </div>
        </div>

        <!-- Pantalla de selecci√≥n de departamento -->
        <section id="departmentSelection" class="department-selection">
            <h2>Selecciona tu Departamento o Ministerio</h2>
            <div class="departments-grid">
                <!-- Ministerio Joven -->
                <div class="department-card juvenil" data-department="Ministerio Joven">
                    <div class="department-icon">üë®‚Äçüéì</div>
                    <h3>Ministerio Joven</h3>
                    <p>JA y Clubes (Aventureros, Conquistadores, Gu√≠as)</p>
                </div>
                
                <!-- Ministerio Infantil -->
                <div class="department-card" data-department="Ministerio Infantil">
                    <div class="department-icon">üë∂</div>
                    <h3>Ministerio Infantil</h3>
                    <p>Anuncios para ni√±os</p>
                </div>
                
                <!-- Escuela Sab√°tica -->
                <div class="department-card" data-department="Escuela Sab√°tica">
                    <div class="department-icon">üìö</div>
                    <h3>Escuela Sab√°tica</h3>
                    <p>Clases y estudios b√≠blicos</p>
                </div>
                
                <!-- Ministerio Personal -->
                <div class="department-card" data-department="Ministerio Personal">
                    <div class="department-icon">üôè</div>
                    <h3>Ministerio Personal</h3>
                    <p>Crecimiento espiritual</p>
                </div>
                
                <!-- Ministerio de la Mujer -->
                <div class="department-card" data-department="Ministerio de la Mujer">
                    <div class="department-icon">üë©</div>
                    <h3>Ministerio de la Mujer</h3>
                    <p>Actividades para mujeres</p>
                </div>
                
                <!-- Ministerio de la Familia -->
                <div class="department-card" data-department="Ministerio de la Familia">
                    <div class="department-icon">üë®‚Äçüë©‚Äçüëß‚Äçüë¶</div>
                    <h3>Ministerio de la Familia</h3>
                    <p>Anuncios familiares</p>
                </div>
                
                <!-- Mayordom√≠a Cristiana -->
                <div class="department-card" data-department="Mayordom√≠a Cristiana">
                    <div class="department-icon">üíº</div>
                    <h3>Mayordom√≠a Cristiana</h3>
                    <p>Administraci√≥n y recursos</p>
                </div>
                
                <!-- Ministerio de Salud -->
                <div class="department-card" data-department="Ministerio de Salud">
                    <div class="department-icon">üè•</div>
                    <h3>Ministerio de Salud</h3>
                    <p>Salud y bienestar</p>
                </div>
                
                <!-- Comunicaci√≥n -->
                <div class="department-card" data-department="Comunicaci√≥n">
                    <div class="department-icon">üì¢</div>
                    <h3>Comunicaci√≥n</h3>
                    <p>Medios y difusi√≥n</p>
                </div>
                
                <!-- Director de Canto -->
                <div class="department-card" data-department="Director de Canto">
                    <div class="department-icon">üé§</div>
                    <h3>Director de Canto</h3>
                    <p>Alabanza y m√∫sica</p>
                </div>
                
                <!-- Director de Sonido -->
                <div class="department-card" data-department="Director de Sonido">
                    <div class="department-icon">üéß</div>
                    <h3>Director de Sonido</h3>
                    <p>Audiovisual y sonido</p>
                </div>
                
                <!-- Dorcas -->
                <div class="department-card" data-department="Dorcas">
                    <div class="department-icon">‚ù§Ô∏è</div>
                    <h3>Dorcas</h3>
                    <p>Servicio y ayuda social</p>
                </div>
                
                <!-- Libertad Religiosa -->
                <div class="department-card" data-department="Libertad Religiosa">
                    <div class="department-icon">‚öñÔ∏è</div>
                    <h3>Libertad Religiosa</h3>
                    <p>Derechos y libertades</p>
                </div>
                
                <!-- Di√°conos y Diaconisas -->
                <div class="department-card" data-department="Di√°conos y Diaconisas">
                    <div class="department-icon">üë®‚Äçüíº</div>
                    <h3>Di√°conos y Diaconisas</h3>
                    <p>Servicio en la iglesia</p>
                </div>
                
                <!-- Ancianos de Iglesia -->
                <div class="department-card" data-department="Ancianos de Iglesia">
                    <div class="department-icon">üë¥</div>
                    <h3>Ancianos de Iglesia</h3>
                    <p>Consejo de ancianos</p>
                </div>
                
                <!-- Secretar√≠a -->
                <div class="department-card" data-department="Secretar√≠a de Iglesia">
                    <div class="department-icon">üìù</div>
                    <h3>Secretar√≠a de Iglesia</h3>
                    <p>Documentaci√≥n y registros</p>
                </div>
                
                <!-- Tesorer√≠a -->
                <div class="department-card" data-department="Tesoreria">
                    <div class="department-icon">üí∞</div>
                    <h3>Tesoreria</h3>
                    <p>Finanzas de la iglesia</p>
                </div>
            </div>
            
            <!-- Opciones para Ministerio Joven (JA o Clubes) -->
            <div id="juvenilOptions" class="juvenil-options">
                <h3>Ministerio Joven - Selecciona una opci√≥n</h3>
                <div class="option-cards">
                    <div class="option-card ja" data-option="JA">
                        <div class="option-icon">üôã‚Äç‚ôÇÔ∏è</div>
                        <h4>J√≥venes Adventistas (JA)</h4>
                        <p>Anuncios para j√≥venes de 16+ a√±os</p>
                    </div>
                    <div class="option-card clubes" data-option="Clubes">
                        <div class="option-icon">üèïÔ∏è</div>
                        <h4>Clubes</h4>
                        <p>Aventureros, Conquistadores, Gu√≠as</p>
                    </div>
                </div>
            </div>
            
            <!-- Subcategor√≠as para Clubes -->
            <div id="clubesSubcategories" class="subcategories">
                <h3>Clubes - Selecciona un club</h3>
                <div class="subcategories-grid">
                    <div class="subcategory-card" data-department="Aventureros">
                        <h4>Aventureros</h4>
                        <p>Ni√±os 6-9 a√±os</p>
                    </div>
                    <div class="subcategory-card" data-department="Conquistadores">
                        <h4>Conquistadores</h4>
                        <p>J√≥venes 10-15 a√±os</p>
                    </div>
                    <div class="subcategory-card" data-department="Gu√≠as Mayores">
                        <h4>Gu√≠as Mayores</h4>
                        <p>J√≥venes 16-21 a√±os</p>
                    </div>
                </div>
            </div>
            
            <!-- Informaci√≥n de sincronizaci√≥n -->
            <div class="sync-info">
                ‚ÑπÔ∏è Los anuncios se sincronizan autom√°ticamente en la nube. El administrador puede ver todos los anuncios desde cualquier dispositivo.
            </div>
        </section>

        <!-- Secci√≥n de formulario de anuncios -->
        <section id="announcementFormSection" class="announcement-form-section">
            <h2 class="section-title" id="formSectionTitle">Crear Nuevo Anuncio</h2>
            <form id="announcementForm" class="announcement-form">
                <input type="hidden" id="selectedDepartment">
                <div class="form-control">
                    <label for="time">Hora del evento:</label>
                    <input type="time" id="time" required>
                </div>
                <div class="form-control">
                    <label for="title">T√≠tulo del anuncio:</label>
                    <input type="text" id="title" placeholder="Ej: Reuni√≥n de oraci√≥n" required>
                </div>
                <div class="form-control">
                    <label for="date">Fecha del evento:</label>
                    <input type="date" id="date" required>
                </div>
                <div class="form-control">
                    <label for="author">Tu nombre (autor):</label>
                    <input type="text" id="author" placeholder="Tu nombre" required>
                </div>
                <div class="form-control full-width">
                    <label for="description">Descripci√≥n:</label>
                    <textarea id="description" placeholder="Describe los detalles del anuncio..." required></textarea>
                </div>
                <button type="submit" class="btn-submit-announcement" id="submitAnnouncementBtn">
                    <span id="submitBtnText">Publicar Anuncio</span>
                    <span id="submitLoading" class="loading" style="display: none;"></span>
                </button>
            </form>
            <div id="formMessage" class="message"></div>
        </section>

        <!-- Secci√≥n para mostrar anuncios del departamento -->
        <section id="announcementsSection" class="announcements-section">
            <div class="current-department">
                <h3 id="currentDepartmentTitle">Anuncios del Departamento</h3>
                <button id="createAnnouncementBtn" class="submit-btn" style="padding: 0.5rem 1rem; font-size: 0.9rem;">+ Crear Anuncio</button>
            </div>
            <div id="announcementsContainer" class="announcements-container">
                <!-- Los anuncios se cargar√°n aqu√≠ din√°micamente -->
                <div class="empty-message" id="emptyMessage">
                    No hay anuncios para este departamento. ¬°Crea el primer anuncio!
                </div>
            </div>
        </section>

        <!-- Panel de administrador -->
        <section id="adminPanel" class="admin-panel">
            <h2 class="section-title">Panel de Administrador - Todos los Anuncios</h2>
            <div class="current-department">
                <h3>Vista completa de todos los anuncios de todos los departamentos</h3>
                <div style="display: flex; gap: 0.5rem; flex-wrap: wrap;">
                    <button id="backToDepartmentsBtn" class="submit-btn" style="padding: 0.5rem 1rem; font-size: 0.9rem;">‚Üê Volver a Departamentos</button>
                    <button id="refreshCloudBtn" class="submit-btn" style="padding: 0.5rem 1rem; font-size: 0.9rem; background-color: var(--verde);">üîÑ Actualizar desde Nube</button>
                </div>
            </div>
            <div id="adminAnnouncements" class="admin-announcements">
                <!-- Los anuncios del panel de administrador se cargar√°n aqu√≠ -->
                <div class="empty-message" id="adminEmptyMessage">
                    No hay anuncios para mostrar.
                </div>
            </div>
            
            <!-- Configuraci√≥n de GitHub para desarrolladores -->
            <div class="github-config">
                <h4>Configuraci√≥n de Sincronizaci√≥n en la Nube</h4>
                <p><small>Para desarrolladores: Esta aplicaci√≥n usa GitHub Gists para almacenar los anuncios en la nube.</small></p>
                <div style="margin-top: 0.5rem;">
                    <button id="showConfigBtn" class="submit-btn" style="padding: 0.4rem 0.8rem; font-size: 0.8rem;">Mostrar Configuraci√≥n</button>
                    <div id="configDetails" style="display: none; margin-top: 1rem;">
                        <p><strong>Gist ID actual:</strong> <span id="currentGistId">No configurado</span></p>
                        <p><strong>Token de GitHub:</strong> <span id="tokenStatus">No configurado</span></p>
                        <div style="margin-top: 0.5rem;">
                            <input type="text" id="gistIdInput" placeholder="ID del Gist existente" style="padding: 0.4rem; width: 100%; margin-bottom: 0.5rem;">
                            <input type="text" id="githubTokenInput" placeholder="Token de GitHub (opcional)" style="padding: 0.4rem; width: 100%; margin-bottom: 0.5rem;">
                            <button id="saveConfigBtn" class="submit-btn" style="padding: 0.4rem 0.8rem; font-size: 0.8rem;">Guardar Configuraci√≥n</button>
                        </div>
                    </div>
                </div>
            </div>
        </section>
    </main>

    <!-- Panel de edici√≥n de anuncios (OCULTO POR DEFECTO) -->
    <div id="editPanel" class="edit-panel">
        <div class="edit-form">
            <div class="edit-header">
                <h3>Editar Anuncio</h3>
                <button id="closeEditBtn" class="close-btn">√ó</button>
            </div>
            <form id="editAnnouncementForm">
                <input type="hidden" id="editId">
                <input type="hidden" id="editAuthor">
                <div class="announcement-form">
                    <div class="form-control">
                        <label for="editDepartment">Departamento:</label>
                        <input type="text" id="editDepartment" readonly style="background-color: #f3f4f6;">
                    </div>
                    <div class="form-control">
                        <label for="editTime">Hora del evento:</label>
                        <input type="time" id="editTime" required>
                    </div>
                    <div class="form-control">
                        <label for="editTitle">T√≠tulo del anuncio:</label>
                        <input type="text" id="editTitle" placeholder="Ej: Reuni√≥n de oraci√≥n" required>
                    </div>
                    <div class="form-control">
                        <label for="editDate">Fecha del evento:</label>
                        <input type="date" id="editDate" required>
                    </div>
                    <div class="form-control">
                        <label for="editAuthorDisplay">Autor (no editable):</label>
                        <input type="text" id="editAuthorDisplay" disabled style="background-color: #f3f4f6;">
                    </div>
                    <div class="form-control full-width">
                        <label for="editDescription">Descripci√≥n:</label>
                        <textarea id="editDescription" placeholder="Describe los detalles del anuncio..." required></textarea>
                    </div>
                    <div class="form-control" style="grid-column: 1 / -1; display: flex; gap: 1rem;">
                        <button type="submit" class="btn-submit-announcement" style="flex: 1;" id="saveEditBtn">
                            <span id="saveEditText">Guardar Cambios</span>
                            <span id="saveEditLoading" class="loading" style="display: none;"></span>
                        </button>
                        <button type="button" id="cancelEditBtn" class="btn-submit-announcement" style="background-color: var(--gris); flex: 1;">Cancelar</button>
                    </div>
                </div>
            </form>
        </div>
    </div>

    <script>
        // Configuraci√≥n para almacenamiento en la nube usando GitHub Gists
        const CLOUD_CONFIG = {
            // Puedes cambiar este Gist ID por uno propio si quieres
            gistId: 'a0b1c2d3e4f5a6b7c8d9e0f1a2b3c4d5', // Este es un ID de ejemplo
            fileName: 'iglesia_anuncios.json',
            useCloud: true, // Cambia a false para desactivar la nube
            githubToken: null // Se puede configurar para mayor seguridad
        };

        // Datos de ejemplo para inicializar la aplicaci√≥n
        const initialAnnouncements = [
            {
                id: 1,
                department: "JA",
                time: "18:00",
                title: "Retiro Espiritual JA",
                description: "Retiro para j√≥venes adventistas en la monta√±a. Traer Biblia y ropa abrigadora.",
                date: "2023-11-15",
                author: "Director Juan",
                authorId: "director_juan",
                createdAt: "2023-10-10T10:00:00",
                deviceId: "web_demo"
            },
            {
                id: 2,
                department: "Conquistadores",
                time: "09:30",
                title: "Acampada de Fin de Semana",
                description: "Acampada para conquistadores en el campamento central.",
                date: "2023-11-20",
                author: "Profesor Pedro",
                authorId: "profesor_pedro",
                createdAt: "2023-10-11T14:30:00",
                deviceId: "web_demo"
            }
        ];

        // Credenciales de administrador
        const ADMIN_CREDENTIALS = {
            username: "Admin",
            password: "Aa.1234#"
        };

        // Estado de la aplicaci√≥n
        let announcements = [];
        let isAdminLoggedIn = false;
        let nextId = 3;
        let isEditing = false;
        let currentEditId = null;
        let currentUser = null;
        let currentDepartment = null;
        let currentView = 'departmentSelection'; // 'departmentSelection', 'announcements', 'form', 'admin'
        let currentSubdepartment = null;
        let deviceId = null;
        let isCloudSyncing = false;

        // Elementos del DOM
        const loginBtn = document.getElementById('loginBtn');
        const logoutBtn = document.getElementById('logoutBtn');
        const backBtn = document.getElementById('backBtn');
        const adminViewBtn = document.getElementById('adminViewBtn');
        const loginForm = document.getElementById('loginForm');
        const submitLogin = document.getElementById('submitLogin');
        const usernameInput = document.getElementById('username');
        const passwordInput = document.getElementById('password');
        const departmentSelection = document.getElementById('departmentSelection');
        const announcementFormSection = document.getElementById('announcementFormSection');
        const announcementsSection = document.getElementById('announcementsSection');
        const announcementsContainer = document.getElementById('announcementsContainer');
        const adminPanel = document.getElementById('adminPanel');
        const adminAnnouncements = document.getElementById('adminAnnouncements');
        const formMessage = document.getElementById('formMessage');
        const emptyMessage = document.getElementById('emptyMessage');
        const adminEmptyMessage = document.getElementById('adminEmptyMessage');
        const editPanel = document.getElementById('editPanel');
        const closeEditBtn = document.getElementById('closeEditBtn');
        const cancelEditBtn = document.getElementById('cancelEditBtn');
        const editAnnouncementForm = document.getElementById('editAnnouncementForm');
        const editIdInput = document.getElementById('editId');
        const editAuthorInput = document.getElementById('editAuthor');
        const editAuthorDisplayInput = document.getElementById('editAuthorDisplay');
        const editDepartmentInput = document.getElementById('editDepartment');
        const editTimeInput = document.getElementById('editTime');
        const editTitleInput = document.getElementById('editTitle');
        const editDateInput = document.getElementById('editDate');
        const editDescriptionInput = document.getElementById('editDescription');
        const createAnnouncementBtn = document.getElementById('createAnnouncementBtn');
        const currentDepartmentTitle = document.getElementById('currentDepartmentTitle');
        const formSectionTitle = document.getElementById('formSectionTitle');
        const selectedDepartmentInput = document.getElementById('selectedDepartment');
        const juvenilOptions = document.getElementById('juvenilOptions');
        const clubesSubcategories = document.getElementById('clubesSubcategories');
        const welcomeMessage = document.getElementById('welcomeMessage');
        const backToDepartmentsBtn = document.getElementById('backToDepartmentsBtn');
        const refreshCloudBtn = document.getElementById('refreshCloudBtn');
        const cloudStatus = document.getElementById('cloudStatus');
        const statusText = document.getElementById('statusText');
        const submitAnnouncementBtn = document.getElementById('submitAnnouncementBtn');
        const submitBtnText = document.getElementById('submitBtnText');
        const submitLoading = document.getElementById('submitLoading');
        const saveEditBtn = document.getElementById('saveEditBtn');
        const saveEditText = document.getElementById('saveEditText');
        const saveEditLoading = document.getElementById('saveEditLoading');
        const showConfigBtn = document.getElementById('showConfigBtn');
        const configDetails = document.getElementById('configDetails');
        const currentGistId = document.getElementById('currentGistId');
        const tokenStatus = document.getElementById('tokenStatus');
        const gistIdInput = document.getElementById('gistIdInput');
        const githubTokenInput = document.getElementById('githubTokenInput');
        const saveConfigBtn = document.getElementById('saveConfigBtn');

        // Inicializar la aplicaci√≥n
        async function initApp() {
            // Establecer fecha m√≠nima en los campos de fecha
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('date').min = today;
            document.getElementById('editDate').min = today;
            
            // Generar un ID √∫nico para el dispositivo
            if (!localStorage.getItem('deviceId')) {
                deviceId = 'device_' + Math.random().toString(36).substr(2, 9) + '_' + Date.now();
                localStorage.setItem('deviceId', deviceId);
            } else {
                deviceId = localStorage.getItem('deviceId');
            }
            
            // Generar un ID √∫nico para el usuario actual (si no existe)
            if (!localStorage.getItem('currentUserId')) {
                const userId = 'user_' + Math.random().toString(36).substr(2, 9);
                localStorage.setItem('currentUserId', userId);
            }
            
            currentUser = localStorage.getItem('currentUserId');
            
            // Cargar configuraci√≥n de la nube
            loadCloudConfig();
            
            // Mostrar estado inicial
            updateCloudStatus('Conectando con la nube...', 'info');
            
            // Cargar anuncios desde la nube
            await loadAnnouncementsFromCloud();
            
            // Verificar si hay sesi√≥n de administrador activa
            const adminSession = localStorage.getItem('adminSession');
            if (adminSession === 'active') {
                isAdminLoggedIn = true;
                updateLoginUI();
                // Si el admin ya estaba logueado, mostrar vista admin
                showAdminView();
            }
            
            // Configurar event listeners
            setupEventListeners();
            
            // Mostrar vista inicial
            showView('departmentSelection');
            
            // Actualizar estado de la nube
            updateCloudStatus('Sincronizado con la nube ‚úì', 'success');
        }

        // Cargar configuraci√≥n de la nube
        function loadCloudConfig() {
            const savedGistId = localStorage.getItem('cloudGistId');
            const savedToken = localStorage.getItem('githubToken');
            
            if (savedGistId) {
                CLOUD_CONFIG.gistId = savedGistId;
            }
            
            if (savedToken) {
                CLOUD_CONFIG.githubToken = savedToken;
            }
            
            // Mostrar configuraci√≥n actual
            currentGistId.textContent = CLOUD_CONFIG.gistId;
            tokenStatus.textContent = CLOUD_CONFIG.githubToken ? 'Configurado' : 'No configurado';
        }

        // Actualizar estado de la nube
        function updateCloudStatus(message, type) {
            cloudStatus.style.display = 'block';
            statusText.textContent = message;
            cloudStatus.className = `message ${type}`;
        }

        // Cargar anuncios desde la nube
        async function loadAnnouncementsFromCloud() {
            if (!CLOUD_CONFIG.useCloud) {
                // Usar datos locales si la nube est√° desactivada
                loadAnnouncementsFromLocal();
                return;
            }
            
            try {
                updateCloudStatus('Cargando anuncios desde la nube...', 'info');
                
                // Intentar cargar desde la nube
                const cloudData = await fetchCloudData();
                
                if (cloudData && cloudData.announcements) {
                    announcements = cloudData.announcements;
                    
                    // Encontrar el ID m√°s alto para continuar la numeraci√≥n
                    if (announcements.length > 0) {
                        nextId = Math.max(...announcements.map(ann => ann.id)) + 1;
                    }
                    
                    // Guardar tambi√©n localmente como backup
                    saveAnnouncementsToLocal();
                    
                    updateCloudStatus(`Cargados ${announcements.length} anuncios desde la nube ‚úì`, 'success');
                } else {
                    // Si no hay datos en la nube, cargar datos locales
                    loadAnnouncementsFromLocal();
                    updateCloudStatus('Usando datos locales (primera vez)', 'warning');
                }
            } catch (error) {
                console.error('Error cargando desde la nube:', error);
                
                // En caso de error, cargar datos locales
                loadAnnouncementsFromLocal();
                updateCloudStatus('Error de conexi√≥n. Usando datos locales.', 'error');
            }
        }

        // Cargar anuncios desde almacenamiento local
        function loadAnnouncementsFromLocal() {
            const savedAnnouncements = localStorage.getItem('churchAnnouncements');
            
            if (savedAnnouncements) {
                announcements = JSON.parse(savedAnnouncements);
                // Encontrar el ID m√°s alto para continuar la numeraci√≥n
                if (announcements.length > 0) {
                    nextId = Math.max(...announcements.map(ann => ann.id)) + 1;
                }
            } else {
                announcements = initialAnnouncements;
                saveAnnouncementsToLocal();
            }
            
            // Asegurarse de que cada anuncio tenga un deviceId
            announcements.forEach(announcement => {
                if (!announcement.deviceId) {
                    announcement.deviceId = 'web_demo';
                }
            });
        }

        // Guardar anuncios en almacenamiento local
        function saveAnnouncementsToLocal() {
            localStorage.setItem('churchAnnouncements', JSON.stringify(announcements));
        }

        // Obtener datos desde la nube (GitHub Gist)
        async function fetchCloudData() {
            if (!CLOUD_CONFIG.gistId) {
                throw new Error('No Gist ID configurado');
            }
            
            const url = `https://api.github.com/gists/${CLOUD_CONFIG.gistId}`;
            const headers = {
                'Accept': 'application/vnd.github.v3+json'
            };
            
            // Si hay token, agregarlo para mayor tasa de l√≠mite
            if (CLOUD_CONFIG.githubToken) {
                headers['Authorization'] = `token ${CLOUD_CONFIG.githubToken}`;
            }
            
            const response = await fetch(url, { headers });
            
            if (!response.ok) {
                if (response.status === 404) {
                    // El Gist no existe, crear uno nuevo
                    return await createNewGist();
                }
                throw new Error(`Error HTTP: ${response.status}`);
            }
            
            const gist = await response.json();
            const fileContent = gist.files[CLOUD_CONFIG.fileName]?.content;
            
            if (!fileContent) {
                return { announcements: [] };
            }
            
            return JSON.parse(fileContent);
        }

        // Crear un nuevo Gist en GitHub
        async function createNewGist() {
            // Solo crear nuevo Gist si hay token (requiere autenticaci√≥n)
            if (!CLOUD_CONFIG.githubToken) {
                throw new Error('Se requiere token de GitHub para crear nuevo Gist');
            }
            
            const initialData = {
                announcements: [],
                createdAt: new Date().toISOString(),
                version: '1.0'
            };
            
            const response = await fetch('https://api.github.com/gists', {
                method: 'POST',
                headers: {
                    'Accept': 'application/vnd.github.v3+json',
                    'Authorization': `token ${CLOUD_CONFIG.githubToken}`,
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({
                    description: 'Anuncios de la Iglesia - Almacenamiento en la Nube',
                    public: false,
                    files: {
                        [CLOUD_CONFIG.fileName]: {
                            content: JSON.stringify(initialData, null, 2)
                        }
                    }
                })
            });
            
            if (!response.ok) {
                throw new Error(`Error creando Gist: ${response.status}`);
            }
            
            const gist = await response.json();
            
            // Guardar el nuevo Gist ID
            CLOUD_CONFIG.gistId = gist.id;
            localStorage.setItem('cloudGistId', gist.id);
            currentGistId.textContent = gist.id;
            
            return initialData;
        }

        // Guardar datos en la nube (GitHub Gist)
        async function saveToCloud() {
            if (!CLOUD_CONFIG.useCloud || !CLOUD_CONFIG.gistId) {
                return false;
            }
            
            if (isCloudSyncing) {
                return false; // Evitar m√∫ltiples sincronizaciones simult√°neas
            }
            
            isCloudSyncing = true;
            
            try {
                const dataToSave = {
                    announcements: announcements,
                    lastUpdated: new Date().toISOString(),
                    totalAnnouncements: announcements.length,
                    version: '1.0'
                };
                
                const url = `https://api.github.com/gists/${CLOUD_CONFIG.gistId}`;
                const headers = {
                    'Accept': 'application/vnd.github.v3+json',
                    'Content-Type': 'application/json'
                };
                
                // Si hay token, agregarlo
                if (CLOUD_CONFIG.githubToken) {
                    headers['Authorization'] = `token ${CLOUD_CONFIG.githubToken}`;
                }
                
                const response = await fetch(url, {
                    method: 'PATCH',
                    headers: headers,
                    body: JSON.stringify({
                        description: `Anuncios de la Iglesia - Actualizado: ${new Date().toLocaleDateString()}`,
                        files: {
                            [CLOUD_CONFIG.fileName]: {
                                content: JSON.stringify(dataToSave, null, 2)
                            }
                        }
                    })
                });
                
                isCloudSyncing = false;
                
                if (!response.ok) {
                    throw new Error(`Error guardando en la nube: ${response.status}`);
                }
                
                return true;
            } catch (error) {
                console.error('Error guardando en la nube:', error);
                isCloudSyncing = false;
                return false;
            }
        }

        // Configurar event listeners
        function setupEventListeners() {
            // Toggle formulario de login
            loginBtn.addEventListener('click', () => {
                loginForm.classList.toggle('active');
            });
            
            // Cerrar formulario de login al hacer clic fuera
            document.addEventListener('click', (e) => {
                if (!loginForm.contains(e.target) && e.target !== loginBtn) {
                    loginForm.classList.remove('active');
                }
            });
            
            // Enviar formulario de login
            submitLogin.addEventListener('click', handleLogin);
            
            // Tambi√©n permitir login con Enter
            passwordInput.addEventListener('keypress', (e) => {
                if (e.key === 'Enter') {
                    handleLogin();
                }
            });
            
            // Cerrar sesi√≥n
            logoutBtn.addEventListener('click', handleLogout);
            
            // Bot√≥n de volver
            backBtn.addEventListener('click', goBack);
            
            // Bot√≥n de vista admin
            adminViewBtn.addEventListener('click', showAdminView);
            
            // Bot√≥n para actualizar desde la nube
            refreshCloudBtn.addEventListener('click', async () => {
                updateCloudStatus('Actualizando desde la nube...', 'info');
                await loadAnnouncementsFromCloud();
                renderAdminAnnouncements();
            });
            
            // Bot√≥n para volver a departamentos desde admin
            backToDepartmentsBtn.addEventListener('click', () => {
                showView('departmentSelection');
            });
            
            // Enviar formulario de anuncio
            document.getElementById('announcementForm').addEventListener('submit', handleAnnouncementSubmit);
            
            // Bot√≥n para crear anuncio
            createAnnouncementBtn.addEventListener('click', () => {
                showView('form');
            });
            
            // Cerrar panel de edici√≥n
            closeEditBtn.addEventListener('click', closeEditPanel);
            cancelEditBtn.addEventListener('click', closeEditPanel);
            
            // Enviar formulario de edici√≥n
            editAnnouncementForm.addEventListener('submit', handleEditAnnouncement);
            
            // Cerrar panel de edici√≥n al hacer clic fuera
            editPanel.addEventListener('click', (e) => {
                if (e.target === editPanel) {
                    closeEditPanel();
                }
            });
            
            // Configuraci√≥n de GitHub
            showConfigBtn.addEventListener('click', () => {
                configDetails.style.display = configDetails.style.display === 'none' ? 'block' : 'none';
            });
            
            saveConfigBtn.addEventListener('click', () => {
                const newGistId = gistIdInput.value.trim();
                const newToken = githubTokenInput.value.trim();
                
                if (newGistId) {
                    CLOUD_CONFIG.gistId = newGistId;
                    localStorage.setItem('cloudGistId', newGistId);
                    currentGistId.textContent = newGistId;
                }
                
                if (newToken) {
                    CLOUD_CONFIG.githubToken = newToken;
                    localStorage.setItem('githubToken', newToken);
                } else if (newToken === '') {
                    CLOUD_CONFIG.githubToken = null;
                    localStorage.removeItem('githubToken');
                }
                
                tokenStatus.textContent = CLOUD_CONFIG.githubToken ? 'Configurado' : 'No configurado';
                showMessage('Configuraci√≥n guardada exitosamente.', 'success');
                
                // Limpiar campos
                gistIdInput.value = '';
                githubTokenInput.value = '';
                
                // Actualizar desde la nueva configuraci√≥n
                loadAnnouncementsFromCloud().then(() => {
                    if (currentView === 'admin') {
                        renderAdminAnnouncements();
                    }
                });
            });
            
            // Seleccionar departamento (excepto Ministerio Joven)
            document.querySelectorAll('.department-card:not([data-department="Ministerio Joven"])').forEach(card => {
                card.addEventListener('click', (e) => {
                    const department = card.getAttribute('data-department');
                    selectDepartment(department);
                });
            });
            
            // Seleccionar Ministerio Joven
            document.querySelector('.department-card[data-department="Ministerio Joven"]').addEventListener('click', () => {
                juvenilOptions.classList.add('active');
                clubesSubcategories.classList.remove('active');
                currentDepartment = "Ministerio Joven";
                currentSubdepartment = null;
            });
            
            // Seleccionar opci√≥n JA o Clubes
            document.querySelectorAll('.option-card').forEach(card => {
                card.addEventListener('click', () => {
                    const option = card.getAttribute('data-option');
                    
                    if (option === 'JA') {
                        selectDepartment('JA');
                    } else if (option === 'Clubes') {
                        juvenilOptions.classList.remove('active');
                        clubesSubcategories.classList.add('active');
                    }
                });
            });
            
            // Seleccionar subcategor√≠a de Clubes
            document.querySelectorAll('.subcategory-card').forEach(card => {
                card.addEventListener('click', () => {
                    const department = card.getAttribute('data-department');
                    selectDepartment(department);
                });
            });
        }

        // Manejar login de administrador
        function handleLogin() {
            const username = usernameInput.value.trim();
            const password = passwordInput.value;
            
            if (username === ADMIN_CREDENTIALS.username && password === ADMIN_CREDENTIALS.password) {
                isAdminLoggedIn = true;
                localStorage.setItem('adminSession', 'active');
                updateLoginUI();
                showMessage('Sesi√≥n de administrador iniciada correctamente.', 'success');
                loginForm.classList.remove('active');
                usernameInput.value = '';
                passwordInput.value = '';
                
                // Mostrar vista de administrador
                showAdminView();
            } else {
                showMessage('Credenciales incorrectas. Intenta nuevamente.', 'error');
            }
        }

        // Manejar logout de administrador
        function handleLogout() {
            isAdminLoggedIn = false;
            localStorage.removeItem('adminSession');
            updateLoginUI();
            showMessage('Sesi√≥n de administrador cerrada.', 'success');
            
            // Volver a vista de departamentos
            showView('departmentSelection');
        }

        // Actualizar la UI seg√∫n el estado de login
        function updateLoginUI() {
            if (isAdminLoggedIn) {
                loginBtn.style.display = 'none';
                logoutBtn.style.display = 'block';
                adminViewBtn.style.display = 'block';
                welcomeMessage.style.display = 'none';
            } else {
                loginBtn.style.display = 'block';
                logoutBtn.style.display = 'none';
                adminViewBtn.style.display = 'none';
                welcomeMessage.style.display = 'block';
            }
        }

        // Mostrar vista de administrador
        function showAdminView() {
            if (!isAdminLoggedIn) {
                showMessage('Debes iniciar sesi√≥n como administrador primero.', 'error');
                loginForm.classList.add('active');
                return;
            }
            
            currentView = 'admin';
            
            // Ocultar todas las vistas
            hideAllViews();
            adminPanel.classList.add('active');
            backBtn.style.display = 'block';
            
            // Renderizar todos los anuncios
            renderAdminAnnouncements();
        }

        // Ocultar todas las vistas
        function hideAllViews() {
            departmentSelection.style.display = 'none';
            announcementFormSection.classList.remove('active');
            announcementsSection.classList.remove('active');
            adminPanel.classList.remove('active');
            juvenilOptions.classList.remove('active');
            clubesSubcategories.classList.remove('active');
            welcomeMessage.style.display = 'none';
        }

        // Seleccionar un departamento
        function selectDepartment(department) {
            currentDepartment = department;
            currentDepartmentTitle.textContent = `Anuncios: ${department}`;
            selectedDepartmentInput.value = department;
            
            // Ocultar todas las opciones de Ministerio Joven
            juvenilOptions.classList.remove('active');
            clubesSubcategories.classList.remove('active');
            
            // Mostrar vista de anuncios
            showView('announcements');
            renderAnnouncements();
        }

        // Volver atr√°s
        function goBack() {
            if (currentView === 'form') {
                showView('announcements');
            } else if (currentView === 'announcements') {
                // Si estamos en opciones de Ministerio Joven, manejar el flujo
                if (currentDepartment === "Ministerio Joven" || juvenilOptions.classList.contains('active') || clubesSubcategories.classList.contains('active')) {
                    if (clubesSubcategories.classList.contains('active')) {
                        clubesSubcategories.classList.remove('active');
                        juvenilOptions.classList.add('active');
                    } else if (juvenilOptions.classList.contains('active')) {
                        juvenilOptions.classList.remove('active');
                        showView('departmentSelection');
                    } else {
                        showView('departmentSelection');
                    }
                } else {
                    showView('departmentSelection');
                }
            } else if (currentView === 'admin') {
                showView('departmentSelection');
            }
        }

        // Mostrar diferentes vistas
        function showView(view) {
            currentView = view;
            
            // Ocultar todas las vistas primero
            hideAllViews();
            backBtn.style.display = 'none';
            
            // Mostrar la vista correspondiente
            if (view === 'departmentSelection') {
                departmentSelection.style.display = 'block';
                welcomeMessage.style.display = 'block';
                if (isAdminLoggedIn) {
                    adminViewBtn.style.display = 'block';
                }
            } else if (view === 'form') {
                announcementFormSection.classList.add('active');
                backBtn.style.display = 'block';
                formSectionTitle.textContent = `Crear Anuncio para: ${currentDepartment}`;
            } else if (view === 'announcements') {
                announcementsSection.classList.add('active');
                backBtn.style.display = 'block';
            } else if (view === 'admin') {
                adminPanel.classList.add('active');
                backBtn.style.display = 'block';
            }
        }

        // Manejar env√≠o de nuevo anuncio
        async function handleAnnouncementSubmit(e) {
            e.preventDefault();
            
            // Obtener valores del formulario
            const department = selectedDepartmentInput.value;
            const time = document.getElementById('time').value;
            const title = document.getElementById('title').value.trim();
            const description = document.getElementById('description').value.trim();
            const date = document.getElementById('date').value;
            const author = document.getElementById('author').value.trim();
            
            // Validar campos
            if (!time || !title || !description || !date || !author) {
                showMessage('Por favor completa todos los campos.', 'error');
                return;
            }
            
            // Mostrar estado de carga
            submitBtnText.textContent = 'Publicando...';
            submitLoading.style.display = 'inline-block';
            submitAnnouncementBtn.disabled = true;
            
            // Crear nuevo anuncio
            const newAnnouncement = {
                id: nextId++,
                department,
                time,
                title,
                description,
                date: date,
                author: author,
                authorId: currentUser,
                deviceId: deviceId,
                createdAt: new Date().toISOString()
            };
            
            // Agregar al array de anuncios
            announcements.push(newAnnouncement);
            
            // Guardar localmente
            saveAnnouncementsToLocal();
            
            // Intentar guardar en la nube
            let cloudSuccess = false;
            if (CLOUD_CONFIG.useCloud) {
                updateCloudStatus('Guardando en la nube...', 'info');
                cloudSuccess = await saveToCloud();
            }
            
            // Restaurar bot√≥n
            submitBtnText.textContent = 'Publicar Anuncio';
            submitLoading.style.display = 'none';
            submitAnnouncementBtn.disabled = false;
            
            if (!CLOUD_CONFIG.useCloud || cloudSuccess) {
                // Limpiar formulario (excepto el nombre del autor)
                document.getElementById('time').value = '';
                document.getElementById('title').value = '';
                document.getElementById('date').value = '';
                document.getElementById('description').value = '';
                // El campo de autor se mantiene
                
                // Mostrar mensaje de √©xito
                const message = cloudSuccess ? 
                    'Anuncio publicado exitosamente y guardado en la nube.' : 
                    'Anuncio publicado exitosamente (modo local).';
                showMessage(message, 'success');
                
                // Actualizar estado de la nube
                if (cloudSuccess) {
                    updateCloudStatus('Sincronizado con la nube ‚úì', 'success');
                }
            } else {
                showMessage('Anuncio guardado localmente, pero hubo un error al guardar en la nube.', 'warning');
                updateCloudStatus('Error de sincronizaci√≥n con la nube', 'error');
            }
            
            // Volver a la vista de anuncios
            showView('announcements');
            
            // Actualizar la visualizaci√≥n
            renderAnnouncements();
            
            // Si el admin est√° logueado, actualizar su vista tambi√©n
            if (isAdminLoggedIn) {
                renderAdminAnnouncements();
            }
        }

        // Manejar edici√≥n de anuncio
        async function handleEditAnnouncement(e) {
            e.preventDefault();
            
            // Obtener valores del formulario
            const id = parseInt(editIdInput.value);
            const time = editTimeInput.value;
            const title = editTitleInput.value.trim();
            const description = editDescriptionInput.value.trim();
            const date = editDateInput.value;
            const author = editAuthorInput.value;
            
            // Validar campos
            if (!time || !title || !description || !date) {
                showMessage('Por favor completa todos los campos.', 'error');
                return;
            }
            
            // Mostrar estado de carga
            saveEditText.textContent = 'Guardando...';
            saveEditLoading.style.display = 'inline-block';
            saveEditBtn.disabled = true;
            
            // Buscar el anuncio a editar
            const index = announcements.findIndex(ann => ann.id === id);
            
            if (index !== -1) {
                // Verificar permisos: solo el autor o el admin pueden editar
                const announcement = announcements[index];
                if (announcement.authorId !== currentUser && !isAdminLoggedIn) {
                    showMessage('No tienes permiso para editar este anuncio.', 'error');
                    saveEditText.textContent = 'Guardar Cambios';
                    saveEditLoading.style.display = 'none';
                    saveEditBtn.disabled = false;
                    closeEditPanel();
                    return;
                }
                
                // Actualizar el anuncio
                announcements[index] = {
                    ...announcement,
                    time,
                    title,
                    description,
                    date,
                    // El autor, authorId, departamento y deviceId se mantienen
                };
                
                // Guardar localmente
                saveAnnouncementsToLocal();
                
                // Intentar guardar en la nube
                let cloudSuccess = false;
                if (CLOUD_CONFIG.useCloud) {
                    updateCloudStatus('Actualizando en la nube...', 'info');
                    cloudSuccess = await saveToCloud();
                }
                
                // Restaurar bot√≥n
                saveEditText.textContent = 'Guardar Cambios';
                saveEditLoading.style.display = 'none';
                saveEditBtn.disabled = false;
                
                // Cerrar panel de edici√≥n
                closeEditPanel();
                
                // Mostrar mensaje de √©xito
                const message = cloudSuccess ? 
                    'Anuncio actualizado exitosamente y guardado en la nube.' : 
                    'Anuncio actualizado exitosamente (modo local).';
                showMessage(message, 'success');
                
                // Actualizar estado de la nube
                if (cloudSuccess) {
                    updateCloudStatus('Sincronizado con la nube ‚úì', 'success');
                }
                
                // Actualizar la visualizaci√≥n
                renderAnnouncements();
                renderAdminAnnouncements();
            }
        }

        // Abrir panel de edici√≥n para un anuncio espec√≠fico
        function openEditPanel(id) {
            // Buscar el anuncio
            const announcement = announcements.find(ann => ann.id === id);
            
            if (announcement) {
                // Verificar permisos: solo el autor o el admin pueden editar
                if (announcement.authorId !== currentUser && !isAdminLoggedIn) {
                    showMessage('Solo el autor o el administrador pueden editar este anuncio.', 'error');
                    return;
                }
                
                // Llenar el formulario con los datos del anuncio
                editIdInput.value = announcement.id;
                editAuthorInput.value = announcement.author;
                editAuthorDisplayInput.value = announcement.author;
                editDepartmentInput.value = announcement.department;
                editTimeInput.value = announcement.time;
                editTitleInput.value = announcement.title;
                editDateInput.value = announcement.date;
                editDescriptionInput.value = announcement.description;
                
                // Mostrar el panel de edici√≥n
                editPanel.classList.add('active');
                isEditing = true;
                currentEditId = id;
            }
        }

        // Cerrar panel de edici√≥n
        function closeEditPanel() {
            editPanel.classList.remove('active');
            isEditing = false;
            currentEditId = null;
            editAnnouncementForm.reset();
            
            // Restaurar texto del bot√≥n por si acaso
            saveEditText.textContent = 'Guardar Cambios';
            saveEditLoading.style.display = 'none';
            saveEditBtn.disabled = false;
        }

        // Eliminar un anuncio
        async function deleteAnnouncement(id) {
            // Buscar el anuncio
            const announcement = announcements.find(ann => ann.id === id);
            
            if (!announcement) return;
            
            // Verificar permisos: solo el autor o el admin pueden eliminar
            if (announcement.authorId !== currentUser && !isAdminLoggedIn) {
                showMessage('Solo el autor o el administrador pueden eliminar este anuncio.', 'error');
                return;
            }
            
            if (confirm('¬øEst√°s seguro de que quieres eliminar este anuncio?')) {
                // Filtrar el anuncio a eliminar
                announcements = announcements.filter(ann => ann.id !== id);
                
                // Guardar localmente
                saveAnnouncementsToLocal();
                
                // Intentar guardar en la nube
                let cloudSuccess = false;
                if (CLOUD_CONFIG.useCloud) {
                    updateCloudStatus('Actualizando en la nube...', 'info');
                    cloudSuccess = await saveToCloud();
                }
                
                // Mostrar mensaje
                const message = cloudSuccess ? 
                    'Anuncio eliminado exitosamente y actualizado en la nube.' : 
                    'Anuncio eliminado exitosamente (modo local).';
                showMessage(message, 'success');
                
                // Actualizar estado de la nube
                if (cloudSuccess) {
                    updateCloudStatus('Sincronizado con la nube ‚úì', 'success');
                }
                
                // Actualizar la visualizaci√≥n
                if (currentView === 'admin') {
                    renderAdminAnnouncements();
                } else {
                    renderAnnouncements();
                }
            }
        }

        // Renderizar anuncios del departamento actual
        function renderAnnouncements() {
            if (!currentDepartment) return;
            
            // Filtrar anuncios del departamento actual
            let departmentAnnouncements = announcements.filter(ann => ann.department === currentDepartment);
            
            // Si NO es admin, mostrar solo los anuncios del usuario actual
            if (!isAdminLoggedIn) {
                departmentAnnouncements = departmentAnnouncements.filter(ann => ann.authorId === currentUser);
            }
            
            // Mostrar mensaje si no hay anuncios
            if (departmentAnnouncements.length === 0) {
                emptyMessage.style.display = 'block';
                announcementsContainer.innerHTML = '';
                announcementsContainer.appendChild(emptyMessage);
                return;
            }
            
            // Ocultar mensaje de vac√≠o
            emptyMessage.style.display = 'none';
            
            // Generar HTML de los anuncios
            let announcementsHTML = '';
            
            // Ordenar por fecha (m√°s cercana primero)
            const sortedAnnouncements = [...departmentAnnouncements].sort((a, b) => {
                return new Date(a.date) - new Date(b.date);
            });
            
            sortedAnnouncements.forEach(announcement => {
                const isMine = announcement.authorId === currentUser;
                const canEdit = isMine || isAdminLoggedIn;
                
                announcementsHTML += `
                    <div class="announcement-card ${isMine ? 'mine' : ''}">
                        ${canEdit ? `
                        <div class="announcement-actions">
                            <button class="action-btn edit-btn" onclick="openEditPanel(${announcement.id})">
                                ‚úèÔ∏è
                            </button>
                            <button class="action-btn delete-btn" onclick="deleteAnnouncement(${announcement.id})">
                                üóëÔ∏è
                            </button>
                        </div>
                        ` : ''}
                        <h3>${announcement.title}</h3>
                        <div class="announcement-category">${announcement.department}</div>
                        <div class="announcement-meta">
                            <span><strong>Hora:</strong> ${announcement.time}</span>
                            <span><strong>Fecha:</strong> ${announcement.date}</span>
                        </div>
                        <div class="announcement-description">
                            ${announcement.description}
                        </div>
                        <div class="announcement-author">
                            <strong>Publicado por:</strong> ${announcement.author}
                            ${isMine ? ' <em>(T√∫)</em>' : ''}
                            ${isAdminLoggedIn ? ` <span style="font-size: 0.7rem; color: #666;">(Desde: ${announcement.deviceId?.substring(0, 8)}...)</span>` : ''}
                        </div>
                    </div>
                `;
            });
            
            announcementsContainer.innerHTML = announcementsHTML;
        }

        // Renderizar todos los anuncios en el panel de administrador
        function renderAdminAnnouncements() {
            // Mostrar mensaje si no hay anuncios
            if (announcements.length === 0) {
                adminEmptyMessage.style.display = 'block';
                adminAnnouncements.innerHTML = '';
                adminAnnouncements.appendChild(adminEmptyMessage);
                return;
            }
            
            // Ocultar mensaje de vac√≠o
            adminEmptyMessage.style.display = 'none';
            
            // Generar HTML de los anuncios
            let adminAnnouncementsHTML = '';
            
            // Ordenar por departamento y fecha
            const sortedAnnouncements = [...announcements].sort((a, b) => {
                if (a.department === b.department) {
                    return new Date(a.date) - new Date(b.date);
                }
                return a.department.localeCompare(b.department);
            });
            
            sortedAnnouncements.forEach(announcement => {
                const isMine = announcement.authorId === currentUser;
                const canEdit = isMine || isAdminLoggedIn;
                
                adminAnnouncementsHTML += `
                    <div class="announcement-card ${isMine ? 'mine' : ''}">
                        <div class="announcement-actions">
                            <button class="action-btn edit-btn" onclick="openEditPanel(${announcement.id})">
                                ‚úèÔ∏è
                            </button>
                            <button class="action-btn delete-btn" onclick="deleteAnnouncement(${announcement.id})">
                                üóëÔ∏è
                            </button>
                        </div>
                        <h3>${announcement.title}</h3>
                        <div class="announcement-category">${announcement.department}</div>
                        <div class="announcement-meta">
                            <span><strong>Hora:</strong> ${announcement.time}</span>
                            <span><strong>Fecha:</strong> ${announcement.date}</span>
                        </div>
                        <div class="announcement-description">
                            ${announcement.description}
                        </div>
                        <div class="announcement-author">
                            <strong>Publicado por:</strong> ${announcement.author}
                            <span style="font-size: 0.7rem; color: #666;">
                                (Usuario: ${announcement.authorId?.substring(0, 8)}... | 
                                Dispositivo: ${announcement.deviceId?.substring(0, 8)}...)
                            </span>
                        </div>
                    </div>
                `;
            });
            
            adminAnnouncements.innerHTML = adminAnnouncementsHTML;
        }

        // Mostrar mensajes temporales
        function showMessage(text, type) {
            formMessage.textContent = text;
            formMessage.className = `message ${type}`;
            
            // Ocultar mensaje despu√©s de 3 segundos
            setTimeout(() => {
                formMessage.style.display = 'none';
            }, 3000);
        }

        // Inicializar la aplicaci√≥n cuando se carga la p√°gina
        document.addEventListener('DOMContentLoaded', initApp);
    </script>
</body>
</html>
